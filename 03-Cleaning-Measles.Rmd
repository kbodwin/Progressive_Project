---
title: "Data Cleaning: Guided Solutions"
author: "YOUR NAME HERE"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
```

```{r, include = FALSE}
library(tidyverse)
library(here)
library(tidymodels)
library(janitor)
```


```{r, message = FALSE}
measles <- read_csv(here("Data", "measles.csv"))
head(measles)
```

## Choosing your variables

Not every variable in your dataset will be used in your analysis.  Choose the 6 variables that you think are most important to your study.  This should include a mix of quantitative and categorical variables, and it should also include the column that labels your *observational units*, which in this case is `name`.

Fill out the code below to make a new dataset called "measles_clean" and keep only the variables you want to ask questions about.  

Reasonable categorical variables to choose are: `type`, `state`, `county`,
or `year`.  
(Think to yourself: why would `index` or `district` or `name` be
bad choices to study?)

You have several quantitative variables in this dataset: 

* `enroll` and `mmr` are good choices.

* `overall`, `xmed`, or `xper` are good choices *if* you are okay with
only studying the states that report these numbers.

* `xrel` is a bad choice, because almost all the data is missing.

* `lat` and `long` are not good choices; there isn't much to learn from "the mean
longitute".

```{r}
measles_clean <- measles %>%
  select(name, _____)
```

Copy the code above into your `Data_Cleaning.Rmd` file.

## Tweaking Categorical Variables

Consider the following three research questions:

> How does the size of schools in New York compare to all other states?

> How does the size of schools in New York compare to those in New Jersey?

> Among schools from only New York, how do the sizes of private and public schools
compare?

Think about what data you would need, specifically in the `state` variable,
to address each of these questions.

*(Note: Since I gave you these research question examples, these are now ones
that you cannot use for your final project.)*

#### The "Other" category

> How does the size of schools in New York compare to all other states?

To answer this question, you would need a variable that labels schools as either 
"New York" or "Not New York", aka "Other".

You would achieve this by:

```{r}
measles_clean <- measles_clean %>%
  mutate(
    ny_or_not = fct_other(province, keep = "New York")
  )
```

As we can see below, we used the information in the `state` variable to 
create a new variable called `ny_or_not`.

```{r}
measles_clean %>%
  tabyl(ny_or_not)
```

#### Narrowing down to a few categories

> How does the size of schools in New York compare to the price in New Jersey?

To answer this question, we don't need a new variable.  However, we are no longer
interested in any states besides New York and New Jersey.  Thus, we want to get
rid of all the data that isn't from these two states.

We accomplish this with:

```{r}
measles_clean <- measles_clean %>%
  filter(
    state %in% c("New York", "New Jersey")
  )
```

Now we can see that `measles_clean` has less information in it that the
original dataset `measles`:

```{r}
measles %>%
  tabyl(state)
```


```{r}
measles_clean %>%
  tabyl(state)
```

#### Limiting ourselves to one category

> Among schools from only New York, how does the size of public schools compare
to the size of private schools?

To address this question, we only need to study schools from New York.  Note that
we are no longer asking a question that compares different states - we can't do
that if we only have data from New York!  Instead, we are limiting our *population*
of interest to only New York schools, and asking different questions (such as comparisons
between types of schools) about that population.

The process is the same as it was for limiting to two or more categories:


```{r}
measles_clean <- measles_clean %>%
  filter(
    state %in% c("New York")
  )
```

## Dealing with missing data and outliers

First, let's reset our `measles_clean` dataset so that it doesn't only have New York:

```{r, message = FALSE}
measles <- read_csv(here("Data", "measles.csv"))
head(measles)
```

```{r}
measles_clean <- measles %>%
  select(name, _____)

measles_clean <- measles_clean %>% drop_na()
```

Next, let's decide if there are any outliers or unreasonable values in our 
quantitative variables, and get rid of them.

In this case, we see a lot of percentages of "-1":

```{r}
measles_clean %>% summary()
```

This doesn't make sense! It appears that -1 has been used to mark missing data.
We also know that percents should be between 0 and 100.

Finally, we aren't interested in schools that have 0 enrollment. We also might not
be interested in schools with too big or too small enrollments.  The choice of
what size schools you want to study is up to you.

Let's drop any data that doesn't conform to those requirements.

```{r}
measles_clean <- measles_clean %>%
  filter(xmed > -1, xmed <= 100) %>%
  filter(xper > -1, xper <= 100) %>%
  filter(overall > -1, overall <= 100) %>%
  filter(enroll > ____, enroll < ____)
```

Fill in the blanks and delete the `filter` steps that relate to variables you aren't using.


## Putting it together

Now, depending on what quantitative variables you decided to use, and what choices you made about getting rid of extreme observations, you've gotten rid
of a lot of the information in your dataset (which is fine!). 

Let's see if your categorical variables still need to be cleaned up:

```{r}
measles_clean %>%
  tabyl(state)

measles_clean %>%
  tabyl(county)

measles_clean %>%
  tabyl(type)
```

Ask yourself: do any of these categorical variables need to be cleaned?

If you still have lots of different categories, the answer is yes!  Which of
the three approaches do you want to take: Make an "other" category, narrow yourself down to a few (2-5) categories, or limit your population to only one category?

If you have only a few categories, the answer may still be yes!  For example, maybe your school types are `Public`, `Private`, and `Charter`. Even though three categories are manageable, you still may want to study "Public vs Other", or "Public vs Private", or limit yourself to only public schools.  


You have seen a few different examples of how we might clean the data
with regard to the `state` variable, you need to decide which of **one** these 
three approaches makes the most sense for **your** research
question of interest.  Copy the relevant code for the approach you choose, 
replacing `state` with the variable you are cleaning, and "New York" and/or "New Jersey" with the categories you are going to study.

You will also need to replace the name `ny_or_not` with a good
descriptive name, if you are choosing the "Other" approach.

Put this code into your `Data_Cleaning.Rmd` file.

A word of caution: Many of the categories only have a few observations; for example,
there is only one school from Alcona County.  These categories are not good choices
to study!  We want to observe enough schools from each chosen category to make a
conclusion from the data.  Keep this in mind, especially if you are using the
`county` or `type` variables!



